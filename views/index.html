<!doctype html>
<html lang='en'>
  <head></head>
  <body>
    <div id="visualization">
      
    </div>
    <div id="instructions">
      <h1>
        Song Visualizer!
      </h1>
      <p>
        Put instructions here.
      </p>
  </body>
  <script src="https://cdn.jsdelivr.net/npm/tweakpane@3.1.0/dist/tweakpane.min.js"></script>
  <script>
    const pane = new Tweakpane.Pane();
    const visualization = document.getElementById("visualization");

    const playBtn = pane.addButton({
        title: 'PLAY',
    });

    playBtn.on('click', () => {
        start('play')
        console.log("playing");
    });

    const pauseBtn = pane.addButton({
        title: 'PAUSE',
    });

    pauseBtn.on('click', () => {
        start('pause')
        console.log("pause song");
    });

    const start = function(state) {
    // document.body.innerHTML = ''
    const canvas = document.createElement( 'canvas' )
    document.body.appendChild( canvas )
    canvas.width = window.innerWidth
    canvas.height = window.innerHeight
    canvas.style.zIndex = "-1"
    const ctx = canvas.getContext( '2d' )

    // audio init
    const audioCtx = new AudioContext()
    const audioElement = document.createElement( 'audio' )
    document.body.appendChild( audioElement )

    // audio graph setup
    const analyser = audioCtx.createAnalyser()
    analyser.fftSize = 1024 // 512 bins
    const player = audioCtx.createMediaElementSource( audioElement )
    player.connect( audioCtx.destination )
    player.connect( analyser )

    // make sure, for this example, that your audiofle is accesssible
    // from your server's root directory... here we assume the file is
    // in the ssame location as our index.html file
    
    if(state='play'){
        audioElement.src = './SalmonLikeTheFish - Glacier.mp3'
        audioElement.play()
    }
    else if(state='pause'){
        audioCtx.close()
    }

    const results = new Uint8Array( analyser.frequencyBinCount )

    draw = function() {
      // temporal recursion, call tthe function in the future
      window.requestAnimationFrame( draw )
      
      // fill our canvas with a black box
      // by doing this every frame we 'clear' the canvas
      ctx.fillStyle = 'black' 
      ctx.fillRect( 0,0,canvas.width,canvas.height )
      
      // set the color to white for drawing our visuaization
      ctx.fillStyle = 'white' 
      
      analyser.getByteFrequencyData( results )
      
      for( let i = 0; i < analyser.frequencyBinCount; i++ ) {
        ctx.fillRect( i, 0, 1, results[i] ) // upside down!
      }
    }
    if(!audioElement.paused){
        draw()
    }
  }

//   window.onload = ()=> document.querySelector('button').onclick = start
  </script>
</html>